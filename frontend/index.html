<!DOCTYPE html>
<html>

<head>
	<title>Basic notification adder</title>
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="mobile-web-app-capable" content="yes">
	<meta name="viewport"
		content="width=device-width, initial-scale=1, user-scalable=1, minimal-ui, viewport-fit=cover">
</head>

<body>

	<button class="hidden push-notif-button" onclick="subscribeToPush()">Subscribe to push notification</button>
	<button onclick="send()">Send push notification</button>

	<style>
		.hidden::after {
			content: '(technically disabled)'
		}
	</style>

	<script>
		const host = 'https://push-api.jipfr.nl' // Make this the API host

		// Service workers
		const sw = true;
		if ("serviceWorker" in navigator) {
			if (sw) {
				navigator.serviceWorker.register("/sw.js").then(
					() => { },
					(err) => {
						console.error(err);
					}
				);
			} else {
				navigator.serviceWorker.getRegistrations().then(function (registrations) {
					for (const registration of registrations) {
						registration.unregister();
					}
				});
			}
		}

		async function send() {
			const topic = encodeURIComponent(prompt("Topic"))
			const title = encodeURIComponent(prompt("Title"))
			const body = encodeURIComponent(prompt("Body"))
			const icon = "https://jipfr.nl/jip-head.png"

			let now = new Date()
			now.setTime(now.getTime() + 1e3 * 60 * 2)
			const at = prompt("At? Enter falsy value") ? now.toISOString() : ''

			await fetch(`${host}/send-notification?topic=${topic}&title=${title}&icon=${icon}&body=${body}${at ? `&at=${at}` : ''}`)
		}

	</script>

	<script>


		if ("Notification" in window && Notification.permission === "default") {
			document.querySelector(".push-notif-button").classList.remove("hidden");
		}


	</script>
</body>

</html>